{% block content %}
{% load static %}
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>榕基IOS程序静态分析报告</title>
    <meta name="description" content="MobSF 报告">
    {% if host_os == 'windows' %}
        <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
    {% else %}
    <style>
    
      /* latin */
      @font-face {
        font-family: 'Open Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: local('Open Sans Regular'), local('OpenSans-Regular'), url('{{base_url}}{% static 'fonts/Open_Sans/OpenSans-Regular.ttf' %}') format('truetype');
      }

      /* latin */
      @font-face {
        font-family: 'Oswald';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: local('Oswald'), local('Oswald'), url('{{base_url}}{% static 'fonts/Oswald/Oswald-Regular.ttf' %}') format('truetype');
      }
     
  </style>
  {% endif %}
  <link rel="stylesheet" href="{{base_url}}{% static "others/css/pdf_report.css" %}">
  <link rel="stylesheet" href="{{base_url}}{% static "adminlte/plugins/fontawesome-free/css/all.min.css" %}">
</head>

  <body bgcolor="FFFFFF">
    <article id="cover">
      <div class="header">
        <img src="{{base_url}}{% static "img/mobsf_logo.png" %}" class="center logo" alt="MobSF Logo"/>
        <div class="htext">iOS 静态分析报告</div>
      </div>
      </br></br></br>
      
     <div class="app">
      {% if app_type not in 'Dylib,A' %}
      <img class="center" id="icon" src="{% if not appstore_details.error %}{{appstore_details.icon}}{% elif icon_path %}{{dwd_dir}}{{ icon_path }}{% else %}{{base_url}}{% static 'img/no_icon.png' %}{% endif %}" alt="app_icon"/>
      {% else %}
      <img class="center" id="icon" src="{{base_url}}{% static 'img/no_icon.png' %}" alt="app_icon"/>
      {% endif %}
    </div>
      <div class="center">
        <h1><i class="fab fa-apple"></i> {{ app_name }} {% if app_version %} ({{app_version}}) {% endif %}</h1>
      </div>
     </br></br></br></br></br>
      <div class="container">
      <table class="basic no_border">
      <tr class="no_border">
        <td class="no_border"><h3>文件名称:</h3></td>
        <td class="no_border"><h3>{{file_name}}</h3></td>
      </tr>
      <tr>
        <td class="no_border"><h3>标识符:</h3></td>
        <td class="no_border"><h3>{{ bundle_id }}</h3></td>
      </tr>
      <tr>
        <td class="no_border"><h3>扫描日期:</h3></td>
        <td class="no_border"><h3>{{ timestamp }}</h3></td>
      </tr>
    {% if app_type not in 'Dylib,A' %}
      {% if average_cvss %}
      <tr>
        <td class="no_border"><h3>平均CVSS评分:</h3></td>
        <td class="no_border"><h3>
  
        {% if average_cvss > 6 %}
        <span class="danger">{{ average_cvss }} </span>
        {% elif average_cvss == 0 %}
        {{ average_cvss }}
        {% elif average_cvss >= 4 %}
        <span class="warning">{{ average_cvss }}</span>
        {% elif average_cvss < 4 %}
        <span class="success">{{ average_cvss }}</span>
        {% endif %}
        </h3></td>
      </tr>
      {% endif %}
      <tr>
        <td class="no_border"><h3>应用安全评分:</h3></td>
        <td class="no_border">
        <h2> 
          {% if appsec.security_score < 30 %}
            <span class="danger">{{ appsec.security_score }}/100 (严重风险)</span>
          {% elif appsec.security_score < 40 %}
            <span class="high">{{ appsec.security_score }}/100 (高风险)</span>
          {% elif appsec.security_score < 60 %}
            <span class="warning">{{ appsec.security_score }}/100 (中等风险)</span>
          {% else %}
            <span class="success">{{ appsec.security_score }}/100 (低风险)</span>
          {% endif %}
        </h2>
        </td>
      </tr>
      <tr>
        <td class="no_border"><h3>等级:</h3></td>
        <td class="no_border">
        <h3> 
          <span class="grade" style="background: 
          {% if appsec.security_score < 30 %}
          #ff0018">F
          {% elif appsec.security_score < 40 %}
          #ffc107">C
          {% elif appsec.security_score < 60 %}
          #f4ff45">B
          {% else %}
          #28a745">A
          {% endif %}
          </span>
        </br>
        </h3>
        </td>
      </tr>
  {% endif %}
      {% if trackers|key:"trackers" %}
      <tr>
        <td class="no_border"><h3>跟踪器检测:</h3></td>
        <td class="no_border"><h3><span {% if trackers.detected_trackers > 0 %} class="warning" {% endif %}>{{ trackers.detected_trackers }}/{{ trackers.total_trackers }}</span></h3></td>
      </tr>
     {% endif %}
      {% if virus_total and virus_total.items|length > 9 and 'request successfully queued' not in virus_total.verbose_msg %}
        <tr>
        <td class="no_border"><h3>VirusTotal检测:</h3></td>
        <td class="no_border"><h3><span class="{% if virus_total.positives > 0 %}danger{% else %}success{% endif %}"> {{ virus_total.positives }}/{{ virus_total.total }}</span></h3></td>
      </tr>
      {% endif %}
    </table>
{% if app_type not in 'Dylib,A' %}
  </br></br>
</br></br>
</br></br>
</br></br>
</br></br>
</br></br>
</br></br>
</br></br>
</br></br>
    <h2><i class="fas fa-chart-pie mr-1"></i> 发现问题严重性</h2>
    <table class="basic tbl-white">
      <tr>
        <th class="td-high"><i class="fas fa-bug"> </i> 高风险</th>
        <th class="td-warning"><i class="fas fa-exclamation-triangle"> </i> 中风险</th>
        <th class="td-info"><i class="fas fa-info"> </i> 信息</th>
        <th class="td-success"><i class="fas fa-check"></i> 安全</th>
        <th class="td-secondary"><i class="fab fa-searchengin"></i> 热点</th>
      </tr>
      <tr>
        <td class="td-high"><h2>{{ appsec.high | length}}</h2></td>
        <td class="td-warning"><h2>{{ appsec.warning | length}}</h2></td>
        <td class="td-info"><h2>{{ appsec.info | length}}</h2></td>
        <td class="td-success"><h2>{{ appsec.secure | length}}</h2></td>
        <td class="td-secondary"><h2>{{ appsec.hotspot | length}}</h2></td>
      </tr>
    </table>
      </div>
    </article>
{% endif %}   
    <article id="contents">

      
      <h2><i class="fas fa-box-open"></i> 文件信息</h2>

      <h5>文件名称:</h5> {{ file_name }}</br>
      <h5>大小: </h5> {{ size }}</br>
      <h5>MD5:</h5> {{ md5 }}</br>
      <h5>SHA1:</h5> {{ sha1 }}</br>
      <h5>SHA256:</h5> {{ sha256 }}</br>
     
{% if app_type not in 'Dylib,A' %}
      <h2><i class="fas fa-info"></i> 应用信息</h2>

      <h5>应用名称:</h5> {{ app_name }}</br>
      <h5>应用类型:</h5> {{ app_type }}</br>
      <h5>标识符:</h5> {{ bundle_id }}</br>
      <h5>SDK名称:</h5> {{ sdk_name }}</br>
      <h5>版本:</h5> {{ app_version }}</br>
      <h5>构建:</h5> {{ build }}</br>
      <h5>平台版本:</h5> {{ platform }}</br>
      <h5>最低OS版本:</h5> {{ min_os_version }}</br>
      <h5>支持平台:</h5> {% for pl in bundle_supported_platforms %} {{pl}}, {% endfor %}</br>
{% endif %}
     {% if binary_info %}
      <h2><i class="fas fa-ad"></i> 二进制信息 </h2>

      <h5>架构:</h5> {{ binary_info.arch }}</br>
      <h5>子架构:</h5> {{ binary_info.subarch }}</br>
      <h5>位数:</h5> {{ binary_info.bit }}</br>
      <h5>字节序:</h5> {{ binary_info.endian }}</br>
      
     {% endif %}

       {% if bundle_url_types|length > 0 %}
       <h2><i class="fas fa-hashtag"></i>自定义URL方案</h2>
       <table class="basic">
                  <thead>
                      <tr>
                          <th>URL名称</th>
                          <th>方案</th>
                      </tr>
                  </thead>
                  <tbody>

                    {% for scheme in bundle_url_types %}
                    <tr>
                      <td>
                           {{scheme | key:"CFBundleURLName" }}
                        {% if scheme|key:"CFBundleTypeRole" %}
                           <br>
                            {{scheme | key:"CFBundleTypeRole" }}
                        {% endif %}
                      </td>
                      <td>
                        {% if scheme|key:"CFBundleURLSchemes" %}
                        {% for ul in scheme.CFBundleURLSchemes %}
                           {{ul}} <br/>
                        {% endfor %}
                        {% endif %}
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
              </table>
        {% endif %}

      {% if permissions %}
      <h2><i class="fa fa-list"></i> 应用权限</h2>

            <table class="basic">
              <thead>
              <tr>
                <th>权限</th>
                <th>状态</th>
                <th>信息</th>
                <th>清单中的原因</th>
              </tr>
            </thead>
                <tbody>
                    {% for perm,desc in permissions.items %}
                    <tr>
                      <td>
                        {{ perm }}
                      </td>
                      <td>
                      {{ desc.status }}
                      </td>
                      <td>
                        {{ desc.info}}
                      </td>
                      <td>
                        {{ desc.description }}
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
            </table>
      {% endif %}

       {% if ats_analysis  %}
      <h2><i class="fas fa-lock"></i> 应用传输安全 (ATS)</h2>
      {% if ats_analysis and 'ats_summary' in ats_analysis and ats_analysis.ats_summary|length > 0 %}
      <span class="danger">高风险: </span>
      <h5 class="description-header">{{ ats_analysis.ats_summary.high }}</h5> | 
      <span class="warning"></i> 警告: </span>
      <h5 class="description-header">{{ ats_analysis.ats_summary.warning }}</h5> |
      <span class="info">信息: </span>
      <h5 class="description-header">{{ ats_analysis.ats_summary.info }}</h5> |
      <span class="success">安全: </span>
      <h5 class="description-header">{{ ats_analysis.ats_summary.secure }}</h5>
    {% endif %}</br>
       <table class="basic">
                   <thead>
                      <tr>
                        <th>序号</th>
                        <th>问题</th>
                        <th>严重性</th>
                        <th>描述</th>
                      </tr>
                  </thead>
                  <tbody>
                    {% if ats_analysis and 'ats_findings' in ats_analysis %}
                      {% for findings in ats_analysis.ats_findings %}
                        <tr>
                          <td>{{ forloop.counter }}</td>
                          <td>
                          {{findings.issue}}
                          <td>
                            {% if findings.severity == "high" %}
                            <span class="danger"> 高风险</span>
                            {% elif findings.severity == "secure" %}
                            <span class="success"> 安全</span>
                            {% elif findings.severity == "warning" %}
                            <span class="warning"> 警告</span>
                            {% elif findings.severity == "info" %}
                            <span class="info"> 信息</span>
                            {% endif %}
                            </td>
                          <td>
                          {{findings.description}}
                          </td>
                        </tr>
                      {% endfor %}
                    {% endif %}
                  </tbody>
                    </table>
                  
        {% endif %}

{% if app_type not in 'Dylib,A' %} 
<!--
         {% if file_analysis %}
      <h2><i class="fa fa-file"></i> 文件分析</h2>
                <table class="basic">
                   <thead>
                      <tr>
                          <th>问题</th>
                          <th>文件</th>
                      </tr>
                  </thead>
                  <tbody>
                    {% for item in file_analysis %}
                    <tr>
                      <td>
                        {{ item.issue }}
                      </td>
                      <td>
                        {% for file in item.files %}
                          {{ file.file_path }}
                          <br/>
                        {% endfor %}
                      </td>
                  
                    </tr>
                    {% endfor %}
                  </tbody>
		</table>
      {% endif %}
-->
{% endif %}
        {% if virus_total and virus_total.items|length > 9 and 'request successfully queued' not in virus_total.verbose_msg %}
       <h2><i class="fas fa-spider"></i> VIRUSTOTAL扫描</h2>
       <p> <h5>{{ virus_total.positives }} / {{ virus_total.total }}</h5> &nbsp; 杀毒软件发现此文件为恶意软件！ </p>
            {% if virus_total.positives %}
          
                    <table class="basic">
                                    <thead>
                                        <tr>
                                            <th>杀毒软件</th>
                                            <th>检测结果</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    {% for av_name,av_result in virus_total.scans.items %}
                                        {% if av_result.detected == True %}
                                            <tr>
                                                <td>
                                                    {{ av_name }}
                                                </td>
                                                <td>
                                                    <span class="danger">{{ av_result.result }}</span>
                                                </td>
                                          </tr>
                                        {% endif %}
                                    {% endfor %}
                               </tbody>
                    </table>
            {% endif %}
      {% endif %}
      
      {% if binary_analysis  %}
      <h2><i class="fas fa-code"></i> {% if app_type not in 'Dylib,A' %}IPA {% endif %}二进制代码分析</h2>
      {% if binary_analysis and 'summary' in binary_analysis and binary_analysis.summary|length > 0 %}
      <span class="danger">高风险: </span>
      <h5 class="description-header">{{ binary_analysis.summary.high }}</h5> | 
      <span class="warning"></i> 警告: </span>
      <h5 class="description-header">{{ binary_analysis.summary.warning }}</h5> |
      <span class="info">信息: </span>
      <h5 class="description-header">{{ binary_analysis.summary.info }}</h5> |
      <span class="success">安全: </span>
      <h5 class="description-header">{{ binary_analysis.summary.secure }}</h5> |
      <span class="disabled">已抑制: </span>
      <h5 class="description-header">{{ binary_analysis.summary.suppressed }}</h5>
    {% endif %}</br>
       <table class="basic">
                  <thead>
                      <tr>
                          <th>序号</th>
                          <th>问题</th>
                          <th>严重性</th>
                          <th>标准</th>
                          <th>描述</th>

                      </tr>
                  </thead>
                     <tbody>
                   {% if binary_analysis and 'findings' in binary_analysis %}
                   {% for issue, details in binary_analysis.findings.items %}
                    <tr>
                      <td>{{ forloop.counter }}</td>
                      <td>
                        {{ issue }}
                      </td>
                      <td>
                        {% if details|key:"severity" == 'info' %}
                          <span class='info'>信息</span>
                        {% elif details|key:"severity" == 'good' %}
                          <span class='success'>安全</span>
                        {% elif details|key:"severity" == 'high' %}
                          <span class='danger'>高风险</span>
                        {% elif details|key:"severity" == 'warning' %}
                          <span class='warning'>警告</span>
                        {% endif %}
                      </td>
                      <td>
                        {% if average_cvss %}
                          <h5>CVSS V2:</h5>
                          {% if details|key:"cvss" > 6 %}
                          <span class="danger">{{ details|key:"cvss" }} (高)</span>
                          {% elif details|key:"cvss" == 0 %}
                          <span class="info">{{ details|key:"cvss" }} (信息)</span>
                          {% elif details|key:"cvss" >= 4 %}
                          <span class="warning">{{ details|key:"cvss" }} (中)</span>
                          {% elif details|key:"cvss" < 4 %}
                          <span class="success">{{ details|key:"cvss" }} (低)</span>
                          {% endif %}
                          </br>
                        {% endif %}
                        {% if details|key:"cwe" %}<h5>CWE: </h5>{{ details|key:"cwe" }}{% endif %}
                        {% if details|key:"owasp-mobile" %}</br> <h5>OWASP Top 10: </h5>{{ details|key:"owasp-mobile" }}{% endif %}
                        {% if details|key:"masvs" %}</br> <h5>OWASP MASVS: </h5>{{ details|key:"masvs" }}{% endif %}
                       </td>
                      <td>
                        {{ details|key:"detailed_desc" }}
                      </td>
                    </tr>
                    {% endfor %}
                    {% endif %}
                 </tbody>
                    </table>
               
        {% endif %}
        {% if macho_analysis  %}
      <h2><i class="fa fa-braille"></i> IPA二进制分析</h2>
       <table class="basic">
                  <thead>
                    <tr>
                      <th>保护</th>
                      <th>状态</th>
                      <th>严重性</th>
                      <th>描述</th>
                     </tr>
                  </thead>
                  <tbody>
                    {% if not macho_analysis %}
                      二进制分析失败。
                    {% else %}
                    <tr>
                      <td><b>NX</b></td>
                      <td>{{macho_analysis.nx.has_nx}}</td>
                      <td><span class="{% if macho_analysis.nx.severity == 'high' %}danger{% elif macho_analysis.nx.severity == 'warning' %}warning{% else %}info{% endif %}">{{macho_analysis.nx.severity}}</span></td>
                      <td>{{macho_analysis.nx.description}}</td>
                    </tr>
                    <tr>
                      <td><b>PIE</b></td>
                      <td>{{macho_analysis.pie.has_pie}}</td>
                      <td><span class="{% if macho_analysis.pie.severity == 'high' %}danger{% elif macho_analysis.pie.severity == 'warning' %}warning{% else %}info{% endif %}">{{macho_analysis.pie.severity}}</span></td>
                      <td>{{macho_analysis.pie.description}}</td>
                    </tr>
                    <tr>
                      <td><b>堆栈保护</b></td>
                      <td>{{macho_analysis.stack_canary.has_canary}}</td>
                      <td><span class="{% if macho_analysis.stack_canary.severity == 'high' %}danger{% elif macho_analysis.stack_canary.severity == 'warning' %}warning{% else %}info{% endif %}">{{macho_analysis.stack_canary.severity}}</span></td>
                      <td>{{macho_analysis.stack_canary.description}}</td>
                    </tr>
                    <tr>
                      <td><b>ARC</b></td>
                      <td>{{macho_analysis.arc.has_arc}}</td>
                      <td><span class="{% if macho_analysis.arc.severity == 'high' %}danger{% elif macho_analysis.arc.severity == 'warning' %}warning{% else %}info{% endif %}">{{macho_analysis.arc.severity}}</span></td>
                      <td>{{macho_analysis.arc.description}}</td>
                    </tr>
                    <tr>
                      <td><b>RPATH</b></td>
                      <td>{{macho_analysis.rpath.has_rpath}}</td>
                      <td><span class="{% if macho_analysis.rpath.severity == 'high' %}danger{% elif macho_analysis.rpath.severity == 'warning' %}warning{% else %}info{% endif %}">{{macho_analysis.rpath.severity}}</span></td>
                      <td>{{macho_analysis.rpath.description}}</td>
                    </tr>
                    <tr>
                      <td><b>代码签名</b></td>
                      <td>{{macho_analysis.code_signature.has_code_signature}}</td>
                      <td><span class="{% if macho_analysis.code_signature.severity == 'high' %}danger{% elif macho_analysis.code_signature.severity == 'warning' %}warning{% else %}info{% endif %}">{{macho_analysis.code_signature.severity}}</span></td>
                      <td>{{macho_analysis.code_signature.description}}</td>
                    </tr>
                    <tr>
                      <td><b>加密</b></td>
                      <td>{{macho_analysis.encrypted.is_encrypted}}</td>
                      <td><span class="{% if macho_analysis.encrypted.severity == 'high' %}danger{% elif macho_analysis.encrypted.severity == 'warning' %}warning{% else %}info{% endif %}">{{macho_analysis.encrypted.severity}}</span></td>
                      <td>{{macho_analysis.encrypted.description}}</td>
                    </tr>
                    <tr>
                      <td><b>符号剥离</b></td>
                      <td>{{macho_analysis.symbol.is_stripped}}</td>
                      <td><span class="{% if macho_analysis.symbol.severity == 'high' %}danger{% elif macho_analysis.symbol.severity == 'warning' %}warning{% else %}info{% endif %}">{{macho_analysis.symbol.severity}}</span></td>
                      <td>{{macho_analysis.symbol.description}}</td>
                    </tr>
                    {% endif %}
                </tbody>
                    </table>
        {% endif %}
  {% if app_type not in 'A' %}
    {% if dylib_analysis or framework_analysis %}
        <h2><i class="fa fa-flag"></i> 动态库和框架二进制分析</h2>
        <table class="basic">
                <thead>
                    <tr>
                        <th>序号</th>
                        <th>动态库/框架</th>
                        <th>NX</th>
                        <th>堆栈保护</th>
                        <th>ARC</th>
                        <th>RPATH</th>
                        <th>代码签名</th>
                        <th>加密</th>
                        <th>符号剥离</th>
                    </tr>
                </thead>
                <tbody>
          {% for dy in dylib_analysis %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{dy.name | relative_path}}</td>
            <td><b>{{dy.nx.has_nx}}</b>
              <br/>
              <span class="{% if dy.nx.severity == 'high' %}danger{% elif dy.nx.severity == 'warning' %}warning{% else %}info{% endif %}">{{dy.nx.severity}}</span><br/>
              <br/>{{dy.nx.description}}</td>
            <td><b>{{dy.stack_canary.has_canary}}</b>
                <br/>
                <span class="{% if dy.stack_canary.severity == 'high' %}danger{% elif dy.stack_canary.severity == 'warning' %}warning{% else %}info{% endif %}">{{dy.stack_canary.severity}}</span><br/>
                <br/>{{dy.stack_canary.description}}</td>
            <td><b>{{dy.arc.has_arc}}</b>
              <br/>
              <span class="{% if dy.arc.severity == 'high' %}danger{% elif dy.arc.severity == 'warning' %}warning{% else %}info{% endif %}">{{dy.arc.severity}}</span><br/>
              <br/>{{dy.arc.description}}</td>
            <td><b>{{dy.rpath.has_rpath}}</b>
              <br/>
              <span class="{% if dy.rpath.severity == 'high' %}danger{% elif dy.rpath.severity == 'warning' %}warning{% else %}info{% endif %}">{{dy.rpath.severity}}</span><br/>
              <br/>{{dy.rpath.description}}</td>
            <td><b>{{dy.code_signature.has_code_signature}}</b>
                <br/>
                <span class="{% if dy.code_signature.severity == 'high' %}danger{% elif dy.code_signature.severity == 'warning' %}warning{% else %}info{% endif %}">{{dy.code_signature.severity}}</span><br/>
                <br/>{{dy.code_signature.description}}</td>
            <td><b>{{dy.encrypted.is_encrypted}}</b>
                <br/>
                <span class="{% if dy.encrypted.severity == 'high' %}danger{% elif dy.encrypted.severity == 'warning' %}warning{% else %}info{% endif %}">{{dy.encrypted.severity}}</span><br/>
                <br/>{{dy.encrypted.description}}</td>
            <td><b>{{dy.symbol.is_stripped}}</b>
              <br/>
              <span class="{% if dy.symbol.severity == 'high' %}danger{% elif dy.symbol.severity == 'warning' %}warning{% else %}info{% endif %}">{{dy.symbol.severity}}</span><br/>
              <br/>{{dy.symbol.description}}</td>
          </tr>
          {% endfor %}
          {% for frm in framework_analysis %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{frm.name}}</td>
        <td><b>{{frm.nx.has_nx}}</b>
          <br/>
          <span class="{% if frm.nx.severity == 'high' %}danger{% elif frm.nx.severity == 'warning' %}warning{% else %}info{% endif %}">{{frm.nx.severity}}</span><br/>
          <br/>{{frm.nx.description}}</td>
        <td><b>{{frm.stack_canary.has_canary}}</b>
            <br/>
            <span class="{% if frm.stack_canary.severity == 'high' %}danger{% elif frm.stack_canary.severity == 'warning' %}warning{% else %}info{% endif %}">{{frm.stack_canary.severity}}</span><br/>
            <br/>{{frm.stack_canary.description}}</td>
        <td><b>{{frm.arc.has_arc}}</b>
          <br/>
          <span class="{% if frm.arc.severity == 'high' %}danger{% elif frm.arc.severity == 'warning' %}warning{% else %}info{% endif %}">{{frm.arc.severity}}</span><br/>
          <br/>{{frm.arc.description}}</td>
        <td><b>{{frm.rpath.has_rpath}}</b>
          <br/>
          <span class="{% if frm.rpath.severity == 'high' %}danger{% elif frm.rpath.severity == 'warning' %}warning{% else %}info{% endif %}">{{frm.rpath.severity}}</span><br/>
          <br/>{{frm.rpath.description}}</td>
        <td><b>{{frm.code_signature.has_code_signature}}</b>
            <br/>
            <span class="{% if frm.code_signature.severity == 'high' %}danger{% elif frm.code_signature.severity == 'warning' %}warning{% else %}info{% endif %}">{{frm.code_signature.severity}}</span><br/>
            <br/>{{frm.code_signature.description}}</td>
        <td><b>{{frm.encrypted.is_encrypted}}</b>
            <br/>
            <span class="{% if frm.encrypted.severity == 'high' %}danger{% elif frm.encrypted.severity == 'warning' %}warning{% else %}info{% endif %}">{{frm.encrypted.severity}}</span><br/>
            <br/>{{frm.encrypted.description}}</td>
        <td><b>{{frm.symbol.is_stripped}}</b>
          <br/>
          <span class="{% if frm.symbol.severity == 'high' %}danger{% elif frm.symbol.severity == 'warning' %}warning{% else %}info{% endif %}">{{frm.symbol.severity}}</span><br/>
          <br/>{{frm.symbol.description}}</td>
      </tr>
      {% endfor %}
                  </tbody>
                  </table>
    {% endif %}
  {% endif %}
<!--static library-->
{% if app_type in 'A' %}
  <h2><i class="fa fa-flag"></i> 静态库二进制分析</h2>
  {% if binary_info.arch == 'MachO' %}

            <table class="basic">
              <thead>
                  <tr>
                      <th>序号</th>
                      <th>静态对象</th>
                      <th>NX</th>
                      <th>堆栈保护</th>
                      <th>ARC</th>
                      <th>RPATH</th>
                      <th>符号剥离</th>
                  </tr>
              </thead>
              <tbody>
          {% if not dylib_analysis %}
          未找到静态对象。
          {% endif %}
          {% for dy in dylib_analysis %}
          <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{dy.name}}</td>
          <td><b>{{dy.nx.has_nx}}</b>
            <br/>
            <span class="{% if dy.nx.severity == 'high' %}danger{% elif dy.nx.severity == 'warning' %}warning{% else %}info{% endif %}">{{dy.nx.severity}}</span>
            <br/>{{dy.nx.description}}</td>
          <td><b>{{dy.stack_canary.has_canary}}</b>
              <br/>
              <span class="{% if dy.stack_canary.severity == 'high' %}danger{% elif dy.stack_canary.severity == 'warning' %}warning{% else %}info{% endif %}">{{dy.stack_canary.severity}}</span>
              <br/>{{dy.stack_canary.description}}</td>
          <td><b>{{dy.arc.has_arc}}</b>
            <br/>
            <span class="{% if dy.arc.severity == 'high' %}danger{% elif dy.arc.severity == 'warning' %}warning{% else %}info{% endif %}">{{dy.arc.severity}}</span>
            <br/>{{dy.arc.description}}</td>
          <td><b>{{dy.rpath.has_rpath}}</b>
            <br/>
            <span class="{% if dy.rpath.severity == 'high' %}danger{% elif dy.rpath.severity == 'warning' %}warning{% else %}info{% endif %}">{{dy.rpath.severity}}</span>
            <br/>{{dy.rpath.description}}</td>
          <td><b>{{dy.symbol.is_stripped}}</b>
            <br/>
            <span class="{% if dy.symbol.severity == 'high' %}danger{% elif dy.symbol.severity == 'warning' %}warning{% else %}info{% endif %}">{{dy.symbol.severity}}</span>
            <br/>{{dy.symbol.description}}</td>
          </tr>
          {% endfor %}
                </tbody>
                </table>
  {% else %}

          <table class="basic">
            <thead>
                <tr>
                    <th>序号</th>
                    <th>共享对象</th>
                    <th>NX</th>
                    <th>堆栈保护</th>
                    <th>RPATH</th>
                    <th>RUNPATH</th>
                    <th>FORTIFY</th>
                    <th>符号剥离</th>
                </tr>
            </thead>
            <tbody>
        {% if not dylib_analysis %}
        未找到静态对象。
        {% endif %}
        {% for so in dylib_analysis %}
        <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{so.name}}</td>
        <td><b>{{so.nx.is_nx}}</b>
          <br/>
          <span class="{% if so.nx.severity == 'high' %}danger{% elif so.nx.severity == 'warning' %}warning{% else %}info{% endif %}">{{so.nx.severity}}</span>
          <br/>{{so.nx.description}}</td>
        <td><b>{{so.stack_canary.has_canary}}</b>
            <br/>
            <span class="{% if so.stack_canary.severity == 'high' %}danger{% elif so.stack_canary.severity == 'warning' %}warning{% else %}info{% endif %}">{{so.stack_canary.severity}}</span>
            <br/>{{so.stack_canary.description}}</td>
        <td><b>{{so.rpath.rpath}}</b>
          <br/>
          <span class="{% if so.rpath.severity == 'high' %}danger{% elif so.rpath.severity == 'warning' %}warning{% else %}info{% endif %}">{{so.rpath.severity}}</span>
          <br/>{{so.rpath.description}}</td>
        <td><b>{{so.runpath.runpath}}</b>
          <br/>
          <span class="{% if so.runpath.severity == 'high' %}danger{% elif so.runpath.severity == 'warning' %}warning{% else %}info{% endif %}">{{so.runpath.severity}}</span>
          <br/>{{so.runpath.description}}</td>
        <td><b>{{so.fortify.is_fortified}}</b>
          <br/>
          <span class="{% if so.fortify.severity == 'high' %}danger{% elif so.fortify.severity == 'warning' %}warning{% else %}info{% endif %}">{{so.fortify.severity}}</span>
          <br/>{{so.fortify.description}}</td>
        <td><b>{{so.symbol.is_stripped}}</b>
          <br/>
          <span class="{% if so.symbol.severity == 'high' %}danger{% elif so.symbol.severity == 'warning' %}warning{% else %}info{% endif %}">{{so.symbol.severity}}</span>
          <br/>{{so.symbol.description}}</td>
        </tr>
        {% endfor %}
              </tbody>
              </table>

  {% endif %}
<!-- ===========================end a analysis ================================== -->
{% endif %}
<!-- end static library-->


    {% if app_type not in 'Dylib,A' %}
    {% if code_analysis  %}
      <h2><i class="fas fa-code"></i> 代码分析</h2>
      {% if code_analysis and 'summary' in code_analysis and code_analysis.summary|length > 0 %}
      <span class="danger">高风险: </span>
      <h5 class="description-header">{{ code_analysis.summary.high }}</h5> | 
      <span class="warning"></i> 警告: </span>
      <h5 class="description-header">{{ code_analysis.summary.warning }}</h5> |
      <span class="info">信息: </span>
      <h5 class="description-header">{{ code_analysis.summary.info }}</h5> |
      <span class="success">安全: </span>
      <h5 class="description-header">{{ code_analysis.summary.secure }}</h5> |
      <span class="disabled">已抑制: </span>
      <h5 class="description-header">{{ code_analysis.summary.suppressed }}</h5>
    {% endif %}</br>
       <table class="basic">
                <thead>
                    <tr>
                        <th>序号</th>
                        <th>问题</th>
                        <th>严重性</th>
                        <th>标准</th>
                        <th>文件</th>
                    </tr>
                </thead>
                <tbody>
                  {% if code_analysis and 'findings' in code_analysis %}
									 {% for rule, details in code_analysis.findings.items %}
                  <tr>
                  <td>{{ forloop.counter }}</td>
                  <td width="25%">
                    {% if details.metadata|key:"ref" %}
                    <a href="{{details.metadata.ref}}" target="_blank" rel="noopener"> {{ details.metadata.description }}</a>
                    {% else %}
                      {{ details.metadata.description }}
                    {% endif %}
                  </td>
                  <td>
                    {% if details.metadata.severity == "high" %}
                      <span class="danger">高风险</span>
                      {% elif details.metadata.severity == "good" %}
                      <span class="success">安全</span>
                      {% elif details.metadata.severity == "warning" %}
                      <span class="warning">警告</span>
                      {% elif details.metadata.severity == "info" %}
                      <span class="info">信息</span>
                      {% endif %}
                  </td>
                  <td>
                    {% if average_cvss %}
                      <h5>CVSS V2:</h5>
                      {% if details.metadata.cvss > 6 %}
                      <span class="danger">{{ details.metadata.cvss }} (高)</span>
                      {% elif details.metadata.cvss == 0 %}
                      <span class="info">{{ details.metadata.cvss }} (信息)</span>
                      {% elif details.metadata.cvss >= 4 %}
                      <span class="warning">{{ details.metadata.cvss }} (中)</span>
                      {% elif details.metadata.cvss < 4 %}
                      <span class="success">{{ details.metadata.cvss }} (低)</span>
                      {% endif %}
                      </br>
                    {% endif %}
                    {% if details.metadata.cwe %}<strong>CWE: </strong>{{details.metadata.cwe }}{% endif %}
                    {% if details.metadata|key:"owasp-mobile" %}</br> <strong>OWASP Top 10: </strong>{{ details.metadata|key:"owasp-mobile" }}{% endif %}
                    {% if details.metadata.masvs %}</br> <strong>OWASP MASVS: </strong>{{ details.metadata.masvs  }}{% endif %}
                  </td>
                  <td style="word-break:break-all;">
                  {% for file_path in details.files %}
                   {{ file_path }}
                  </br>
                  {% endfor %}
                  </td>
                </tr>    
              {% endfor %}
              {% endif %}
              </tbody>
              </table>
                   
      {% endif %}
    {% endif %}
    {% if firebase_urls %} 
    <h2><i class="fas fa-database"></i> FIREBASE数据库分析</h2>
          <table class="basic">
                <thead>
                <tr>
                  <th>标题</th>
                  <th>严重性</th>
                  <th>描述</th>
                </tr>
              </thead>
          <tbody>
                {% for find in firebase_urls %}
                <tr>
                  <td>{{ find.title }}</td>
                  <td>
                  {% if find.severity == 'high' %}
                  <span class="danger">高风险</span>
                  {% elif find.severity  == 'secure' %}
                    <span class="success">安全</span>
                  {% elif find.severity  == 'warning' %}
                    <span class="warning">警告</span>
                  {% elif find.severity  == 'info' %}
                  <span class="info">信息</span>
                  {% endif %}
                  </td>
                  <td>{{ find.description }}</td>
                  </tr>
                {% endfor %} 
                  </tbody>
                  </table>
      {% endif %}
      {% if domains  %}

      <h2><i class="fa fa-exclamation"></i> OFAC制裁国家</h2>
      <p>此应用可能与以下OFAC制裁名单中的国家通信。</p>
      <table id="table_ofac" class="table table-bordered table-hover table-striped">
           <thead>
           <tr>
              <th>域名</th>
              <th>国家/地区</th>
           </tr>
          </thead>
          <tbody>
          {% for domain, details in domains.items %}
          {% if details|key:"ofac" == True %}
           <tr><td>{{domain}}</td>
           <td>
             <strong>IP: </strong>{{details|key:"geolocation"|key:"ip"}}  <br/>
             <strong>国家: </strong>{{details|key:"geolocation"|key:"country_long"}} <br/>
             <strong>地区: </strong>{{details|key:"geolocation"|key:"region"}} <br/>
             <strong>城市: </strong>{{details|key:"geolocation"|key:"city"}} <br/>
           </td>
           </tr>
           {% endif %}
           {% endfor %}
         </tbody>
     </table>
     
      <h2><i class="fab fa-searchengin"></i> 域名恶意软件检查</h2>
         <table  class="basic">
                  <thead>
                  <tr>
                     <th>域名</th>
                     <th>状态</th>
                     <th>地理位置</th>
                  </tr>
                 </thead>
                 <tbody>
                 {% for domain, details in domains.items %}
                  <tr><td>{{domain}}</td><td> 

                    {% if details|key:"bad" == "yes" %}
                    <span class="danger">恶意软件</span><br/>
             
                      <h5>URL: </h5> {{details|key:"domain_or_url"}}
                      <h5>IP: </h5> <span class="danger">{{details|key:"ip"}}</span>
                      <h5>描述: </h5> {{details|key:"desc"}}
                   
                  {% else %}
                    <span class="success">正常</span><br/>
                  {% endif %}
                  </td>
                  <td>
                    {% if details|key:"geolocation" %}
                
                      <h5>IP: </h5> {{details|key:"geolocation"|key:"ip"}}  <br/>
                      <h5>国家: </h5> {{details|key:"geolocation"|key:"country_long"}} <br/>
                      <h5>地区: </h5> {{details|key:"geolocation"|key:"region"}} <br/>
                      <h5>城市: </h5> {{details|key:"geolocation"|key:"city"}} <br/>
                      <h5>纬度: </h5> {{details|key:"geolocation"|key:"latitude"}} <br/>
                      <h5>经度: </h5> {{details|key:"geolocation"|key:"longitude"}} <br/>
                      <h5>查看: </h5> <a target="_blank" href="http://maps.google.com/maps?q={{details|key:"geolocation"|key:"latitude"}},{{details|key:"geolocation"|key:"longitude"}}">谷歌地图</a>
                    {% else %}
                    没有可用的地理位置信息。
                    {% endif %}
                  </td>
                  </tr>
                  {% endfor %}
                </tbody>
            </table>
      {% endif %}

<!-- Display urls only for dylib files-->
{% if app_type in 'Dylib,A' %}
       {% if urls %} 
      <h2><i class="fas fa-globe"></i> URL地址 </h2>
      <table class="basic">
                  <thead>
                  <tr>
                     <th>URL</th>
                     <th>文件</th>
                  </tr>
                 </thead>
                  <tbody>
									{% for urldict in urls %}
                    <tr>
                       <td style="word-break:break-all;">
                       {% for u in urldict|key:"urls" %}
                         {{ u }} </br>
                       {% endfor %}
                        </td>
                       <td width="35%" style="word-break:break-all;">
                         {{urldict|key:"path"}}
                       </td>
                    </tr>
                  {% endfor %} 
										</tbody>
										</table>
        {% endif %}
{% endif %}
      {% if emails %}
      <h2><i class="fas fa-envelope"></i> 电子邮件</h2>
          <table class="basic">
                  <thead>
                  <tr>
                     <th>邮箱</th>
                     <th>文件</th>
                  </tr>
                 </thead>
                  <tbody>
									{% for email_dict in emails %}
                    <tr>
                       <td style="word-break:break-all;">
                       {% for em in email_dict|key:"emails" %}
                         {{ em }} </br>
                       {% endfor %}
                        </td>

                       <td style="word-break:break-all;">
                         {{email_dict|key:"path"}}
                       </td>
                    </tr>
                  {% endfor %} 
										</tbody>
										</table>
      {% endif %}

      {% if trackers|key:"trackers" %}
      <h2><i class="fas fa-user-secret"></i> 跟踪器</h2>
       <table class="basic">
            <thead>
                <tr>
                    <th>跟踪器</th>
                    <th>类别</th>
                    <th>URL</th>
                </tr>
            </thead>
          
            <tbody>
              {% for trk in trackers|key:"trackers" %}
              <tr>
                <td>
                  {{trk.name}}
                </td>
                <td>
                  {{trk.categories}}
                </td>
                <td>
                  <a target="_blank" href="{{trk.url}}" rel="noopener noreferrer">{{trk.url}}</a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
        </table>
         {% endif %}
  
    {% if secrets %}
      <h2><i class="fas fa-key"></i> 硬编码密钥</h2>
          <table class="basic">
                  <thead>
                  <tr>
                    <th>可能的密钥</th>
                  </tr>
                </thead>
                  <tbody>
                  {% for sec in secrets %}
                    <tr>
                      <td style="word-break:break-all;">
                      {{ sec }}
                        </td>
                    </tr>
                  {% endfor %} 
                    </tbody>
                    </table>
      {% endif %}

    <!--Only for dylib-->
    {% if app_type in 'Dylib,A' %}
    <h2><i class="fa fa-th"></i> 符号</h2>
        <table class="basic">
                <tbody>
                {% for val in file_analysis %}
                  <tr>
                    <td style="word-break:break-all;">
                    {{ val }}
                      </td>
                  </tr>
                {% endfor %} 
                  </tbody>
                  </table>
    {% endif %}

    {% if app_type not in 'Dylib,A' %}
    {% if not appstore_details.error %}
    <h2><i class="fab fa-app-store-ios"></i> 应用商店信息 </h2>

                  <p>                                       
                    <h5>标题:</h5> 
                    {{ appstore_details.title }}
                  </p>
                  <p>                                       
                    <h5>评分:</h5> 
                   {{ appstore_details.score}}

                   <h5>功能:</h5> 
                    {% for fea in appstore_details.features %}
                      {{ fea }}, 
                    {% endfor %}

                   <h5>价格:</h5> 
                      {{ appstore_details.price }}

                   <h5>类别:</h5> 
                     {% for cat in appstore_details.category %}
                        {{ cat }}, 
                    {% endfor %}
                   </br>
                    <h5>应用商店URL:</h5> 
		                <a target="_blank" href="{{ appstore_details.itunes_url }}" rel="noopener noreferrer">{{ appstore_details.app_id }} </a>
                
                  </p>
		          <p>
                  <h5>开发者:</h5> 
                    {{appstore_details.developer}}  <br/>
		          <h5>开发者ID:</h5> 
                   {{appstore_details.developer_id}}  <br/>
                   <h5>开发者网站:</h5> 
                   {{appstore_details.developer_website }} <br/>
                   <h5>开发者URL:</h5> 
                   {{appstore_details.developer_url}} <br/>
                   <h5>支持设备</h5>
                   {% for dev in appstore_details.supported_devices %}
                      {{ dev }}, 
                      {% endfor %}
                    <br/>              
		            </p>
                 <p>                                     
                    <h5>描述:</h5> 
                    <p>{{ appstore_details.description }}</p>
                  </p>
       {% endif %}
    {% endif %}
    <h2><i class="fas fa-list"></i> 扫描日志</h2>
    <table id="scan_logs" class="basic">
      <tr>
          <th>时间戳</th>
          <th>事件</th>
          <th>错误</th>
      </tr>
  <tbody>
    {% for log in logs %}
    <tr>
      <td>
        {{log.timestamp}}
      </td>
      <td>
        {{log.status}}
      </td>
      <td>
        {% if not log.exception %}
        <p class="text-success">
          正常
        </p>
        {% else %}
        <p class="text-danger">
        {{log.exception}}
         </p>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
  </table>
    </article>
    <article id="columns">
      </br>
      <hr>
      <h3>报告由 MobSF {{ version }} 生成 </h3>
      <section>
        <p>
          榕基移动安全框架是一个自动化的、多合一的移动应用(Android/iOS/Windows)渗透测试、恶意软件分析和安全评估框架，能够执行静态和动态分析。
        </p>
        <p>
        <strong>© {% now "Y" %} 移动安全框架 - MobSF | <a href="https://ajinabraham.com">Ajin Abraham</a> | <a href="https://opensecurity.in">OpenSecurity</a>.</strong>
      </p>
      </section>
    </article>
  </body>
</html>
{% endblock %}